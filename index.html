<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Calculadora de Viabilidade de Importa√ß√£o | Fabio Machado</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- SEO b√°sico -->
  <meta name="description"
        content="Calcule rapidamente o custo e a viabilidade da sua Importa√ß√£o Simplificada ou Importa√ß√£o Formal Mar√≠tima ou A√©rea, incluindo NCM, impostos, despesas aduaneiras, courier e margem de venda. Ferramenta did√°tica criada por Fabio Machado Consultoria Estrat√©gica." />
  <meta name="author" content="Fabio Machado Consultoria Estrat√©gica" />
  <link rel="canonical" href="https://fabioluismachado01-alt.github.io/calculadora-importacao/" />

  <!-- Open Graph / Social -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Calculadora de Viabilidade de Importa√ß√£o ‚Äì Fabio Machado" />
  <meta property="og:description"
        content="Simulador gratuito para avaliar custos, tributa√ß√£o e viabilidade da sua Importa√ß√£o Simplificada ou Importa√ß√£o Formal Mar√≠tima/A√©rea, com orienta√ß√£o de quem vive o com√©rcio exterior na pr√°tica." />
  <meta property="og:url" content="https://fabioluismachado01-alt.github.io/calculadora-importacao/" />
  <meta property="og:image" content="https://fabioluismachado01-alt.github.io/calculadora-importacao/logo-fabio.png" />

  <!-- Favicon / √≠cone -->
  <link rel="icon" href="logo-fabio.png" type="image/png" />

  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest" />
  <meta name="theme-color" content="#020617" id="themeColorMeta" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />

  <style>
    :root {
      --navy: #020617;
      --navy-light: #0f172a;
      --gold: #eab308;
      --gold-light: #facc15;
      --bg: #020617;
      --card-bg: #0b1220;
      --border: #1e293b;
      --text: #e5e7eb;
      --text-muted: #9ca3af;
      --danger: #fca5a5;
      --radius: 14px;
    }

    /* Tema claro sobrescrevendo vari√°veis */
    body[data-theme="light"] {
      --bg: #f3f4f6;
      --card-bg: #ffffff;
      --border: #e5e7eb;
      --text: #020617;
      --text-muted: #6b7280;
    }

    * {
      box-sizing: border-box;
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    }

    body {
      margin: 0;
      background: radial-gradient(circle at top, #1e293b 0, var(--bg) 55%, #000 100%);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      border-bottom: 1px solid var(--border);
      padding: 10px 18px;
      background: rgba(2, 6, 23, 0.92);
      backdrop-filter: blur(10px);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    body[data-theme="light"] header {
      background: rgba(255, 255, 255, 0.9);
    }

    .brand {
      display: flex;
      align-items: flex-start;
      gap: 10px;
    }

    header h1 {
      font-size: 16px;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 2px;
      font-weight: 600;
    }

    .subtitle {
      font-size: 11px;
      color: var(--text-muted);
      font-weight: 400;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 10px;
      text-align: right;
    }

    .insta-link {
      font-size: 12px;
      color: #38bdf8;
      text-decoration: none;
      font-weight: 500;
    }

    .insta-link:hover {
      text-decoration: underline;
    }

    #cotacaoInfo {
      font-size: 12px;
      color: var(--text-muted);
    }

    main {
      max-width: 1000px;
      margin: 24px auto;
      padding: 0 16px 70px;
      width: 100%;
    }

    .card {
      background: linear-gradient(145deg, #111827 0%, #020617 70%);
      border: 1px solid var(--border);
      padding: 20px;
      border-radius: var(--radius);
      margin-bottom: 20px;
      box-shadow: 0 12px 32px rgba(0,0,0,0.45);
    }

    body[data-theme="light"] .card {
      background: var(--card-bg);
      box-shadow: 0 8px 24px rgba(15,23,42,0.12);
    }

    .card h2 {
      margin: 0 0 12px;
      font-size: 18px;
      font-weight: 600;
    }

    .grid {
      display: grid;
      gap: 14px;
    }

    @media (min-width: 640px) {
      .grid-2 {
        grid-template-columns: repeat(2, 1fr);
      }
      .grid-3 {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    label {
      font-size: 13px;
      margin-bottom: 6px;
      display: block;
      font-weight: 500;
    }

    input, select, textarea {
      width: 100%;
      padding: 8px 10px;
      background: #0f172a;
      color: #e5e7eb;
      border: 1px solid #1f2937;
      border-radius: 10px;
      font-size: 14px;
      outline: none;
      transition: border 0.15s, box-shadow 0.15s, background 0.15s, color 0.15s;
    }

    body[data-theme="light"] input,
    body[data-theme="light"] select,
    body[data-theme="light"] textarea {
      background: #f9fafb;
      color: #020617;
      border-color: #e5e7eb;
    }

    input:focus, select:focus, textarea:focus {
      border-color: var(--gold);
      box-shadow: 0 0 0 1px rgba(234, 179, 8, 0.5);
    }

    textarea {
      resize: vertical;
    }

    button {
      background: linear-gradient(90deg, var(--gold-light), var(--gold));
      color: #0f172a;
      border: none;
      padding: 8px 16px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.15s;
      box-shadow: 0 8px 20px rgba(234, 179, 8, 0.3);
      white-space: nowrap;
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 32px rgba(234, 179, 8, 0.45);
    }

    .danger {
      color: var(--danger);
      font-size: 13px;
      margin-top: 8px;
    }

    .success {
      color: #bbf7d0;
      font-size: 13px;
      margin-top: 8px;
    }

    .result {
      background: rgba(250, 204, 21, 0.1);
      padding: 16px;
      border-radius: var(--radius);
      border: 1px solid rgba(250, 204, 21, 0.3);
    }

    .result-label {
      font-size: 14px;
      display: flex;
      justify-content: space-between;
      margin-bottom: 4px;
    }

    .result-value {
      font-weight: 700;
      color: #facc15;
    }

    .muted {
      font-size: 12px;
      color: var(--text-muted);
    }

    footer {
      margin-top: auto;
      padding: 22px;
      background: #020617;
      border-top: 1px solid var(--border);
      text-align: center;
      font-size: 14px;
      color: #e5e7eb;
    }

    body[data-theme="light"] footer {
      background: #0f172a;
      color: #e5e7eb;
    }

    /* Bot√£o flutuante WhatsApp */
    .whatsapp-float {
      position: fixed;
      right: 16px;
      bottom: 16px;
      width: 54px;
      height: 54px;
      border-radius: 50%;
      background: #22c55e;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #ffffff;
      font-size: 26px;
      text-decoration: none;
      box-shadow: 0 12px 30px rgba(22, 163, 74, 0.7);
      z-index: 40;
    }

    .whatsapp-float:hover {
      transform: translateY(-2px);
      box-shadow: 0 16px 36px rgba(22, 163, 74, 0.85);
    }

    /* Seletor de modo */
    .mode-switch {
      display: inline-flex;
      border-radius: 999px;
      padding: 2px;
      background: #020617;
      border: 1px solid var(--border);
    }

    body[data-theme="light"] .mode-switch {
      background: #e5e7eb;
    }

    .mode-option {
      padding: 6px 14px;
      font-size: 13px;
      cursor: pointer;
      border-radius: 999px;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .mode-option input {
      width: auto;
    }

    .mode-option.active {
      background: linear-gradient(90deg, var(--gold-light), var(--gold));
      color: #020617;
      font-weight: 600;
      box-shadow: 0 8px 20px rgba(234, 179, 8, 0.35);
    }

    .mode-option.active input {
      accent-color: #020617;
    }

    @media (max-width: 480px) {
      header h1 {
        font-size: 14px;
      }
      .subtitle {
        font-size: 10px;
      }
      .insta-link {
        display: none;
      }
    }
  </style>
</head>

<body data-theme="dark">

<header>
  <div class="brand">
    <h1>
      Calculadora de Viabilidade de Importa√ß√£o
      <span class="subtitle">
        Desenvolvido por Fabio Machado ‚Ä¢ Consultoria, Aulas &amp; Mentoria em Importa√ß√£o
      </span>
      <span class="subtitle" id="modoAtualInfo">
        Modo selecionado: Importa√ß√£o Simplificada
      </span>
    </h1>
  </div>

  <div class="header-right">
    <a href="https://instagram.com/fabiomachado.br" target="_blank" class="insta-link"
       aria-label="Acesse o Instagram de Fabio Machado">@fabiomachado.br</a>
    <button id="themeToggle" type="button">Modo claro</button>
    <div id="cotacaoInfo">Cota√ß√£o: carregando‚Ä¶</div>
  </div>
</header>

<main>

  <!-- üîπ COMO USAR ESTA CALCULADORA -->
  <div class="card">
    <h2>Como usar esta calculadora</h2>
    <p class="muted">
      Esta ferramenta foi criada para te dar uma vis√£o r√°pida da viabilidade de um produto na
      <strong>Importa√ß√£o Simplificada</strong> ou na
      <strong>Importa√ß√£o Formal Mar√≠tima ou A√©rea</strong>. Siga os passos abaixo:
    </p>
    <ol class="muted" style="padding-left:18px; margin-top:6px;">
      <li>Escolha abaixo se o c√°lculo ser√° para <strong>Simplificada</strong> ou <strong>Formal (Mar√≠tima/A√©rea)</strong>.</li>
      <li>Informe o <strong>NCM</strong> e verifique poss√≠veis √≥rg√£os anuentes, tributos especiais e restri√ß√µes.</li>
      <li>Confirme a <strong>cota√ß√£o do d√≥lar</strong> (autom√°tica ou manual).</li>
      <li>Preencha os <strong>dados do produto, frete, impostos e despesas</strong> da remessa.</li>
      <li>Clique em <strong>‚ÄúCalcular custo de importa√ß√£o‚Äù</strong> e, em seguida, simule a <strong>viabilidade de venda</strong>.</li>
    </ol>
    <p class="muted" style="margin-top:8px;">
      Os resultados s√£o aproximados e servem como apoio √† tomada de decis√£o. Para opera√ß√µes formais mar√≠timas ou a√©reas,
      sempre valide o cen√°rio com seu despachante aduaneiro ou consultor de confian√ßa.
    </p>

    <!-- Seletor de modo -->
    <div style="margin-top:12px;">
      <span class="muted" style="display:block; margin-bottom:6px;">Selecione o modo de c√°lculo:</span>
      <div class="mode-switch" id="modeSwitch">
        <label class="mode-option active">
          <input type="radio" name="modoImportacao" value="simplificada" checked>
          Simplificada (courier / remessa expressa)
        </label>
        <label class="mode-option">
          <input type="radio" name="modoImportacao" value="formal">
          Formal (Mar√≠tima / A√©rea)
        </label>
      </div>
    </div>
  </div>

  <!-- üîπ SE√á√ÉO NCM + TRATAMENTOS (comum aos dois modos) -->
  <div class="card">
    <h2>NCM &amp; Tratamentos Administrativos</h2>

    <div class="grid grid-2">
      <div>
        <label for="ncmCodigo">NCM (8 d√≠gitos)</label>
        <input type="text" id="ncmCodigo" maxlength="8" placeholder="ex.: 95030089">
        <p class="muted">Use o bot√£o ao lado para abrir o simulador oficial da Receita e conferir o enquadramento.</p>
      </div>

      <div style="display:flex;align-items:flex-end; justify-content:flex-end;">
        <button type="button" id="consultarNcmBtn">Consultar NCM na Receita</button>
      </div>
    </div>

    <br>

    <div class="grid grid-2">
      <!-- Campo s√≥ para modo Simplificada -->
      <div id="campoSimplificada">
        <label>Permite importa√ß√£o simplificada?</label>
        <select id="ncmSimplificada">
          <option value="">Selecione‚Ä¶</option>
          <option value="sim">Sim</option>
          <option value="nao">N√£o</option>
          <option value="depende">Depende</option>
        </select>
      </div>

      <div>
        <label>Tributos especiais</label>
        <label><input type="checkbox" id="ncmCide"> CIDE</label><br>
        <label><input type="checkbox" id="ncmAntidumping"> Antidumping</label><br>
        <label><input type="checkbox" id="ncmComp"> Medidas compensat√≥rias</label>
      </div>
    </div>

    <br>

    <label>√ìrg√£os anuentes</label>
    <div class="grid grid-3" style="font-size:14px;">
      <label><input type="checkbox" class="ncm-orgao" value="anvisa"> Anvisa</label>
      <label><input type="checkbox" class="ncm-orgao" value="inmetro"> Inmetro</label>
      <label><input type="checkbox" class="ncm-orgao" value="mapa"> MAPA</label>
      <label><input type="checkbox" class="ncm-orgao" value="exercito"> Ex√©rcito</label>
      <label><input type="checkbox" class="ncm-orgao" value="ibama"> Ibama</label>
      <label><input type="checkbox" class="ncm-orgao" value="anatel"> Anatel</label>
      <label><input type="checkbox" class="ncm-orgao" value="outros"> Outros</label>
    </div>

    <br>

    <label>O produto possui bateria?</label>
    <div style="display:flex; gap:16px; font-size:14px;">
      <label><input type="radio" name="produtoBateria" value="nao" checked> N√£o</label>
      <label><input type="radio" name="produtoBateria" value="sim"> Sim</label>
    </div>

    <br>

    <label>O produto √© Bluetooth ou Wi-Fi?</label>
    <div style="display:flex; gap:16px; font-size:14px;">
      <label><input type="radio" name="produtoRadio" value="nao" checked> N√£o</label>
      <label><input type="radio" name="produtoRadio" value="sim"> Sim</label>
    </div>

    <br>

    <label>Observa√ß√µes / Anota√ß√µes</label>
    <textarea id="ncmObs" rows="4"
      placeholder="Use este espa√ßo para anotar detalhes relevantes do NCM, descri√ß√£o da mercadoria, exce√ß√µes, etc."></textarea>

    <div id="ncmAlerta" class="danger"></div>
  </div>

  <!-- üîπ SE√á√ÉO C√ÇMBIO (comum) -->
  <div class="card">
    <h2>C√¢mbio</h2>

    <label><input type="checkbox" id="cotacaoAuto" checked> Usar cota√ß√£o autom√°tica</label>

    <label>Cota√ß√£o do d√≥lar (USD ‚Üí BRL)</label>
    <input type="number" id="cotacao" step="0.0001" disabled>
    <p class="muted">Se preferir, desmarque a op√ß√£o acima para editar a cota√ß√£o manualmente.</p>
  </div>

  <!-- =========================
       BLOCO SIMPLIFICADA
  =============================-->
  <div id="calcSimplificada">

    <!-- üîπ PRODUTO SIMPLIFICADA -->
    <div class="card">
      <h2>Produto &amp; Custos (USD) ‚Äì Importa√ß√£o Simplificada</h2>

      <div class="grid grid-2">
        <div>
          <label>Nome do produto</label>
          <input type="text" id="produtoNome" placeholder="Ex.: Fone Bluetooth">
        </div>

        <div>
          <label>Custo unit√°rio (USD)</label>
          <input type="number" id="custoUSD" step="0.01" value="0.24">
        </div>

        <div>
          <label>Quantidade</label>
          <input type="number" id="quantidade" value="1250">
        </div>

        <div>
          <label>Frete internacional (USD)</label>
          <input type="number" id="freteUSD" step="0.01" value="250">
        </div>

        <div>
          <label>Seguro internacional (USD)</label>
          <input type="number" id="seguroUSD" step="0.01" value="0">
        </div>
      </div>
    </div>

    <!-- üîπ IMPOSTOS SIMPLIFICADA -->
    <div class="card">
      <h2>Impostos Simplificados</h2>

      <div class="grid grid-2">
        <div>
          <label>II ‚Äì Imposto de Importa√ß√£o (%)</label>
          <input type="number" id="iiPercent" value="60">
        </div>

        <div>
          <label>ICMS do estado (%)</label>
          <input type="number" id="icmsPercent" value="18">
        </div>
      </div>
    </div>

  </div><!-- /calcSimplificada -->

  <!-- =========================
       BLOCO FORMAL
  =============================-->
  <div id="calcFormal" style="display:none;">

    <!-- üîπ PRODUTO FORMAL -->
    <div class="card">
      <h2>Produto &amp; Custos (USD) ‚Äì Importa√ß√£o Formal Mar√≠tima ou A√©rea</h2>

      <div class="grid grid-2">
        <div>
          <label>Nome do produto</label>
          <input type="text" id="produtoNomeFormal" placeholder="Ex.: Fone Bluetooth">
        </div>

        <div>
          <label>Custo unit√°rio (USD)</label>
          <input type="number" id="custoUSDFormal" step="0.01" value="3.5">
        </div>

        <div>
          <label>Quantidade</label>
          <input type="number" id="quantidadeFormal" value="500">
        </div>

        <div>
          <label>Frete internacional (USD)</label>
          <input type="number" id="freteUSDFormal" step="0.01" value="390">
        </div>

        <div>
          <label>Seguro internacional (USD)</label>
          <input type="number" id="seguroUSDFormal" step="0.01" value="50">
        </div>
      </div>
      <p class="muted">Os campos acima representam o valor aduaneiro (produto, frete e seguro) da sua importa√ß√£o formal.</p>
    </div>

    <!-- üîπ DESPESAS ADUANEIRAS / PORTU√ÅRIAS -->
    <div class="card">
      <h2>Despesas Aduaneiras &amp; Portu√°rias (BRL)</h2>
      <p class="muted">
        Aqui entram os custos cobrados por agente de cargas, terminal, armazenagem e servi√ßos de despacho.
        Use valores aproximados em reais.
      </p>

      <div class="grid grid-2">
        <div>
          <label>Siscomex (R$)</label>
          <input type="number" id="siscomexBRL" step="0.01" value="830.00">
        </div>
        <div>
          <label>Despachante aduaneiro (R$)</label>
          <input type="number" id="despachanteBRL" step="0.01" value="2300.00">
        </div>
        <div>
          <label>Armazenagem (R$)</label>
          <input type="number" id="armazenagemBRL" step="0.01" value="6529.99">
        </div>
        <div>
          <label>Transporte rodovi√°rio / entrega interna (R$)</label>
          <input type="number" id="transporteBRL" step="0.01" value="373.13">
        </div>
        <div>
          <label>Marinha Mercante (% sobre o frete em BRL)</label>
          <input type="number" id="marinhaPercent" step="0.01" value="8">
          <p class="muted">A calculadora aplica este percentual sobre o valor do frete convertido para BRL.</p>
        </div>
        <div>
          <label>Outras despesas (BL, capatazia, handling, laudos, etc.) (R$)</label>
          <input type="number" id="outrasDespesasBRL" step="0.01" value="9280.00">
        </div>
      </div>
    </div>

    <!-- üîπ IMPOSTOS FORMAIS -->
    <div class="card">
      <h2>Impostos Federais &amp; ICMS ‚Äì Importa√ß√£o Formal</h2>
      <p class="muted">
        Preencha as al√≠quotas conforme o enquadramento do seu NCM. A base de c√°lculo segue a l√≥gica padr√£o:
        CIF, depois II, IPI, PIS/COFINS e, por fim, ICMS com ou sem gross-up.
      </p>

      <div class="grid grid-2">
        <div>
          <label>II ‚Äì Imposto de Importa√ß√£o (%)</label>
          <input type="number" id="iiFormalPercent" step="0.01" value="20">
        </div>
        <div>
          <label>IPI ‚Äì Imposto sobre Produtos Industrializados (%)</label>
          <input type="number" id="ipiFormalPercent" step="0.01" value="15">
        </div>
        <div>
          <label>PIS (%)</label>
          <input type="number" id="pisFormalPercent" step="0.01" value="2.1">
        </div>
        <div>
          <label>COFINS (%)</label>
          <input type="number" id="cofinsFormalPercent" step="0.01" value="10.65">
        </div>
        <div>
          <label>ICMS (%)</label>
          <input type="number" id="icmsFormalPercent" step="0.01" value="18">
        </div>
        <div>
          <label>ICMS com gross-up?</label>
          <select id="icmsFormalGrossUp">
            <option value="sim">Sim (gross-up)</option>
            <option value="nao">N√£o (sem gross-up)</option>
          </select>
        </div>
      </div>
    </div>

  </div><!-- /calcFormal -->

  <!-- üîπ BOT√ÉO CALCULAR IMPORTA√á√ÉO (COMUM) -->
  <div class="card" style="text-align:center;">
    <button id="calcularBtn">Calcular custo de importa√ß√£o (modo selecionado)</button>
  </div>

  <!-- üîπ RESULTADO IMPORTA√á√ÉO (COMUM) -->
  <div class="card result" id="resultadoCard" style="display:none;">
    <h2>Resultado da Importa√ß√£o</h2>

    <div class="result-label">
      Modo de c√°lculo:
      <span class="result-value" id="resultadoModo"></span>
    </div>

    <div class="result-label">
      Valor dos produtos (BRL):
      <span class="result-value" id="resProdutos"></span>
    </div>
    <div class="result-label">
      Valor do frete + seguro (BRL):
      <span class="result-value" id="resFreteSeguro"></span>
    </div>
    <div class="result-label">
      Valor dos impostos (II + IPI + PIS + COFINS + ICMS) (BRL):
      <span class="result-value" id="resImpostos"></span>
    </div>
    <div class="result-label">
      Despesas aduaneiras / courier (BRL):
      <span class="result-value" id="resDespesas"></span>
    </div>

    <hr>

    <div class="result-label">
      Custo total do lote:
      <span class="result-value" id="resultadoTotal"></span>
    </div>

    <div class="result-label">
      Custo unit√°rio do produto:
      <span class="result-value" id="resultadoUnitario"></span>
    </div>

    <p class="muted" id="resResumoBase"></p>
  </div>

  <!-- üîπ SIMULAR VIABILIDADE DE VENDA -->
  <div class="card" id="viabilidadeCard" style="display:none;">
    <h2>Simular Viabilidade de Venda</h2>
    <p class="muted">
      Preencha os campos em verde (como na planilha). O custo do produto j√° vem do c√°lculo de importa√ß√£o
      selecionado (Simplificada ou Formal), mas voc√™ pode ajustar manualmente.
    </p>

    <div class="grid grid-2">
      <div>
        <label>Valor da venda (R$)</label>
        <input type="number" id="vVenda" step="0.01" value="19.90">
      </div>

      <div>
        <label>Tarifa fixa do marketplace (R$)</label>
        <input type="number" id="vTarifaFixa" step="0.01" value="6.00">
      </div>

      <div>
        <label>Tarifa an√∫ncio (%)</label>
        <input type="number" id="vTarifaAnuncioPercent" step="0.01" value="13.00">
      </div>

      <div>
        <label>Impostos sobre venda (%)</label>
        <input type="number" id="vImpostosPercent" step="0.01" value="4.00">
      </div>

      <div>
        <label>Embalagem (R$)</label>
        <input type="number" id="vEmbalagem" step="0.01" value="0.50">
      </div>

      <div>
        <label>Custo do produto (R$)</label>
        <input type="number" id="vCustoProduto" step="0.01">
      </div>
    </div>

    <div style="text-align:center;margin-top:14px;">
      <button id="btnCalcVenda" type="button">Calcular viabilidade de venda</button>
    </div>

    <div class="result" id="viabResultado" style="margin-top:14px; display:none;">
      <div class="result-label">
        Margem contribui√ß√£o (por unidade):
        <span class="result-value" id="viabMargem"></span>
      </div>
      <div class="result-label">
        Margem ROI:
        <span class="result-value" id="viabROI"></span>
      </div>
      <div class="result-label">
        Investimento √ó Retorno (lote):
        <span class="result-value" id="viabMontao"></span>
      </div>

      <div id="viabAlerta"></div>
    </div>
  </div>

  <!-- üîπ SOBRE F√ÅBIO MACHADO -->
  <div class="card">
    <h2>Sobre F√°bio Machado</h2>
    <p class="muted">
      F√°bio Machado atua h√° anos com com√©rcio exterior, apoiando opera√ß√µes de
      <strong>Importa√ß√£o Simplificada</strong> e
      <strong>Importa√ß√£o Formal Mar√≠tima ou A√©rea</strong>, al√©m de estrat√©gias de venda em marketplaces
      e canais digitais. O foco √© sempre construir opera√ß√µes sustent√°veis, com leitura correta de NCM,
      enquadramento tribut√°rio e escolha do canal de importa√ß√£o mais vantajoso para cada caso.
    </p>
    <p class="muted">
      Esta calculadora foi criada para que voc√™ tenha uma vis√£o clara de custos, riscos e viabilidade antes de
      fechar qualquer pedido com o fornecedor, trazendo para o digital a mesma l√≥gica pr√°tica utilizada em
      consultorias e mentorias individuais.
    </p>
    <p class="muted">
      Acompanhe o dia a dia das opera√ß√µes, an√°lises de casos reais e conte√∫dos sobre importa√ß√£o no Instagram:
      <a href="https://instagram.com/fabiomachado.br" target="_blank"
         style="color:#38bdf8; text-decoration:none; font-weight:500;">@fabiomachado.br</a>.
    </p>
  </div>

  <!-- üîπ QUER APRENDER A IMPORTAR COMIGO? -->
  <div class="card" style="border-color: rgba(250,204,21,0.6);">
    <h2>Quer aprender a importar comigo?</h2>

    <p class="muted">
      Voc√™ pode aprender importa√ß√£o de forma estruturada atrav√©s das <strong>aulas completas</strong>, onde ensino passo a passo
      tudo sobre NCM, leitura aduaneira, Importa√ß√£o Simplificada e Importa√ß√£o Formal Mar√≠tima ou A√©rea, contratos, fornecedores,
      c√°lculo de custos e estrat√©gias para ter margem real nos marketplaces.
    </p>
    <p class="muted">
      Para quem busca um acompanhamento mais pr√≥ximo, existe tamb√©m a <strong>mentoria individual</strong>, onde voc√™ recebe
      orienta√ß√µes personalizadas e ainda tem acesso a uma rede de parceiros: empresas especializadas em contrato de c√¢mbio,
      despachantes aduaneiros de confian√ßa e agentes de cargas que ajudam a reduzir o custo da sua importa√ß√£o de forma estrat√©gica
      ‚Äî contatos exclusivos para alunos.
    </p>

    <div style="display:flex; flex-wrap:wrap; gap:10px; margin-top:10px;">
      <a href="https://wa.me/message/UDEZKZS4LQWXB1" target="_blank">
        <button type="button">Falar sobre aulas e mentoria</button>
      </a>

      <a href="https://instagram.com/fabiomachado.br" target="_blank">
        <button type="button"
          style="background:linear-gradient(90deg,#fb7185,#ec4899); color:white; box-shadow:0 8px 20px rgba(236,72,153,0.4);">
          Ver bastidores no Instagram
        </button>
      </a>
    </div>
  </div>

  <!-- üîπ FAQ / PERGUNTAS FREQUENTES -->
  <div class="card">
    <h2>Perguntas frequentes</h2>

    <details style="margin-bottom:8px;">
      <summary style="cursor:pointer; font-size:14px; font-weight:600;">Qual a diferen√ßa entre Importa√ß√£o Simplificada e Importa√ß√£o Formal Mar√≠tima ou A√©rea?</summary>
      <p class="muted" style="margin-top:6px;">
        De forma bem direta: a Importa√ß√£o Simplificada costuma ser usada para remessas de menor valor, normalmente via courier,
        com um fluxo mais enxuto de despacho. J√° a Importa√ß√£o Formal Mar√≠tima ou A√©rea envolve registro completo da declara√ß√£o
        de importa√ß√£o, canal de fiscaliza√ß√£o e regras mais detalhadas de documenta√ß√£o. Na pr√°tica, cada modalidade tem limites,
        riscos e custos diferentes ‚Äî e √© isso que explico com calma nas aulas.
      </p>
    </details>

    <details style="margin-bottom:8px;">
      <summary style="cursor:pointer; font-size:14px; font-weight:600;">Os valores desta calculadora s√£o 100% exatos?</summary>
      <p class="muted" style="margin-top:6px;">
        N√£o. A calculadora √© uma ferramenta de apoio, com base em par√¢metros que voc√™ mesmo informa (al√≠quotas, taxas, frete, etc.).
        O objetivo √© te dar clareza de ordem de grandeza e viabilidade do projeto. Para n√∫meros finais, principalmente em opera√ß√µes
        formais, √© importante alinhar com seu despachante aduaneiro e acompanhar a legisla√ß√£o atualizada.
      </p>
    </details>

    <details style="margin-bottom:8px;">
      <summary style="cursor:pointer; font-size:14px; font-weight:600;">Serve para pessoa f√≠sica e para empresa?</summary>
      <p class="muted" style="margin-top:6px;">
        Sim. A l√≥gica de c√°lculo de custos funciona tanto para quem importa como pessoa f√≠sica quanto para CNPJ.
        O que muda √© o enquadramento, limites de valor, possibilidade de aproveitamento de cr√©dito e algumas regras espec√≠ficas,
        temas que s√£o abordados de forma detalhada nas aulas e mentorias.
      </p>
    </details>

    <details>
      <summary style="cursor:pointer; font-size:14px; font-weight:600;">O que eu ganho ao estudar com voc√™ em vez de s√≥ usar a calculadora?</summary>
      <p class="muted" style="margin-top:6px;">
        A calculadora te ajuda a fazer conta, mas √© o <strong>conhecimento de contexto</strong> que evita erro caro:
        entender quando faz sentido Simplificada ou Formal, como negociar com fornecedor, quais documentos exigir,
        como se proteger de surpresas de tributa√ß√£o e como transformar tudo isso em lucro real nos marketplaces.
        √â isso que eu entrego nas aulas e na mentoria.
      </p>
    </details>
  </div>

</main>

<footer>
  <p style="margin:4px 0; opacity:0.9;">
    Desenvolvido por <strong>Fabio Machado Consultoria &amp; Mentoria em Importa√ß√£o</strong>
  </p>

  <p style="margin:6px 0 10px;">
    Quer aprender a importar da maneira correta, evitando erros e preju√≠zos?
    <br>
    <a href="https://wa.me/message/UDEZKZS4LQWXB1"
       target="_blank"
       style="color:#facc15; font-weight:600; text-decoration:none;">
      Fale conosco pelo WhatsApp üì≤ (12) 99184-4541
    </a>
  </p>

  <p style="margin:4px 0; font-size:12px; opacity:0.7;">
    Este simulador √© para fins educacionais ‚Äî atualize sempre as al√≠quotas, taxas e par√¢metros conforme sua opera√ß√£o
    e consulte seu despachante ou assessor aduaneiro antes de tomar decis√µes.
  </p>
</footer>

<!-- Bot√£o flutuante WhatsApp -->
<a href="https://wa.me/message/UDEZKZS4LQWXB1"
   class="whatsapp-float"
   target="_blank"
   aria-label="Falar com Fabio Machado no WhatsApp">
  üí¨
</a>

<script>
  /* ================================
       0) TEMA CLARO/ESCURO
  =================================*/
  const themeToggle = document.getElementById("themeToggle");
  const themeColorMeta = document.getElementById("themeColorMeta");

  function applyTheme(theme) {
    document.body.setAttribute("data-theme", theme);
    localStorage.setItem("theme", theme);
    themeToggle.textContent = theme === "dark" ? "Modo claro" : "Modo escuro";
    themeColorMeta.setAttribute("content", theme === "dark" ? "#020617" : "#f3f4f6");
  }

  const savedTheme = localStorage.getItem("theme") || "dark";
  applyTheme(savedTheme);

  themeToggle.addEventListener("click", () => {
    const current = document.body.getAttribute("data-theme") || "dark";
    applyTheme(current === "dark" ? "light" : "dark");
  });

  /* ================================
       0.1) SELETOR DE MODO
  =================================*/
  const modeSwitch = document.getElementById("modeSwitch");
  const modeOptions = modeSwitch.querySelectorAll(".mode-option");
  const calcSimplificada = document.getElementById("calcSimplificada");
  const calcFormal = document.getElementById("calcFormal");
  const modoAtualInfo = document.getElementById("modoAtualInfo");
  const campoSimplificada = document.getElementById("campoSimplificada");

  function modoAtual() {
    const checked = document.querySelector('input[name="modoImportacao"]:checked');
    return checked ? checked.value : "simplificada";
  }

  function atualizarModoVisual() {
    const modo = modoAtual();
    modeOptions.forEach((opt) => {
      const input = opt.querySelector("input");
      if (input.value === modo) opt.classList.add("active");
      else opt.classList.remove("active");
    });

    if (modo === "simplificada") {
      calcSimplificada.style.display = "";
      calcFormal.style.display = "none";
      modoAtualInfo.textContent = "Modo selecionado: Importa√ß√£o Simplificada";
      if (campoSimplificada) campoSimplificada.style.display = "";
    } else {
      calcSimplificada.style.display = "none";
      calcFormal.style.display = "";
      modoAtualInfo.textContent = "Modo selecionado: Importa√ß√£o Formal Mar√≠tima ou A√©rea";
      if (campoSimplificada) campoSimplificada.style.display = "none";
    }
  }

  modeSwitch.addEventListener("change", atualizarModoVisual);
  atualizarModoVisual();

  /* ================================
       1) COTA√á√ÉO AUTOM√ÅTICA
  =================================*/
  const cotacaoTexto = document.getElementById("cotacaoInfo");
  const cotacaoInput = document.getElementById("cotacao");
  const cotacaoAuto = document.getElementById("cotacaoAuto");

  async function buscarCotacao() {
    try {
      cotacaoTexto.textContent = "Cota√ß√£o: carregando‚Ä¶";
      const res = await fetch("https://economia.awesomeapi.com.br/json/last/USD-BRL");
      const data = await res.json();
      const rate = parseFloat(data.USDBRL.bid);
      if (!isNaN(rate)) {
        cotacaoInput.value = rate.toFixed(4);
        cotacaoTexto.textContent = "Cota√ß√£o: R$ " + rate.toFixed(4);
      } else {
        cotacaoTexto.textContent = "Cota√ß√£o: erro";
      }
    } catch (e) {
      cotacaoTexto.textContent = "Cota√ß√£o: erro";
    }
  }

  buscarCotacao();
  setInterval(buscarCotacao, 60000);

  cotacaoAuto.addEventListener("change", () => {
    cotacaoInput.disabled = cotacaoAuto.checked;
    if (cotacaoAuto.checked) buscarCotacao();
  });

  /* ================================
       2) NCM ALERTAS + OBSERVA√á√ïES
  =================================*/
  const ncmSimplificada = document.getElementById("ncmSimplificada");
  const ncmCide = document.getElementById("ncmCide");
  const ncmAntidumping = document.getElementById("ncmAntidumping");
  const ncmComp = document.getElementById("ncmComp");
  const ncmAlerta = document.getElementById("ncmAlerta");
  const ncmObs = document.getElementById("ncmObs");
  const orgaosCheckboxes = document.querySelectorAll(".ncm-orgao");
  const bateriaRadios = document.querySelectorAll('input[name="produtoBateria"]');
  const radioRadios = document.querySelectorAll('input[name="produtoRadio"]');
  const orgaoAnatel = Array.from(orgaosCheckboxes).find(c => c.value === "anatel");

  let manualObs = "";
  let updatingObs = false;

  // Guarda parte manual digitada pelo aluno
  ncmObs.addEventListener("input", () => {
    if (updatingObs) return;
    const marker = "\n\n--- Observa√ß√µes autom√°ticas ---";
    const texto = ncmObs.value;
    const idx = texto.indexOf(marker);
    manualObs = idx >= 0 ? texto.slice(0, idx) : texto;
  });

  function atualizarAlertasNCM() {
    const msgs = [];

    if (ncmSimplificada.value === "nao")
      msgs.push("‚ö†Ô∏è Este NCM foi marcado como n√£o eleg√≠vel √† importa√ß√£o simplificada.");

    if (ncmAntidumping.checked)
      msgs.push("‚ö†Ô∏è NCM com antidumping: revise viabilidade, pode inviabilizar a importa√ß√£o.");

    ncmAlerta.textContent = msgs.join(" | ");
    atualizarObsAutomaticas();
  }

  function atualizarObsAutomaticas() {
    const autoMsgs = [];

    // √ìrg√£os anuentes
    const selecionados = Array.from(orgaosCheckboxes)
      .filter(c => c.checked)
      .map(c => {
        const mapa = {
          anvisa: "Anvisa",
          inmetro: "Inmetro",
          mapa: "MAPA",
          exercito: "Ex√©rcito",
          ibama: "Ibama",
          anatel: "ANATEL",
          outros: "outros √≥rg√£os competentes"
        };
        return mapa[c.value] || c.value;
      });

    if (selecionados.length > 0) {
      const lista = selecionados.join(", ");
      autoMsgs.push(
        "Este NCM possui tratamento administrativo com √≥rg√£o(s) anuente(s): " + lista +
        ". Em regra, mercadorias sujeitas √† anu√™ncia desses √≥rg√£os n√£o s√£o enquadradas como remessa simplificada. " +
        "Considere planejar a opera√ß√£o via despacho formal e providenciar previamente as certifica√ß√µes, licen√ßas e registros correspondentes antes de importar."
      );
      if (!ncmSimplificada.value) {
        ncmSimplificada.value = "nao";
      }
    }

    // CIDE / Antidumping / Medidas compensat√≥rias
    if (ncmCide.checked || ncmAntidumping.checked || ncmComp.checked) {
      autoMsgs.push(
        "Foi sinalizada a exist√™ncia de CIDE, antidumping e/ou medidas compensat√≥rias para este NCM. " +
        "Revise com aten√ß√£o as al√≠quotas e condi√ß√µes no S√≠tio de Apoio ao Importador (Portal √önico/Siscomex) " +
        "e valide com seu despachante ou assessor aduaneiro se a opera√ß√£o √© permitida e permanece economicamente vi√°vel."
      );
    }

    // Produto com bateria
    const bateriaValor = Array.from(bateriaRadios).find(r => r.checked)?.value;
    if (bateriaValor === "sim") {
      autoMsgs.push(
        "Produto com bateria: solicite ao fornecedor a ficha de seguran√ßa MSDS (Material Safety Data Sheet) " +
        "e confirme com o courier/transportadora as exig√™ncias espec√≠ficas para transporte, embalagem e documenta√ß√£o."
      );
    }

    // Produto com Bluetooth / Wi-Fi ‚Üí ANATEL
    const rfValor = Array.from(radioRadios).find(r => r.checked)?.value;
    if (rfValor === "sim") {
      if (orgaoAnatel && !orgaoAnatel.checked) orgaoAnatel.checked = true;

      autoMsgs.push(
        "Produto com tecnologia sem fio (Bluetooth e/ou Wi-Fi): dispositivos que operam em radiofrequ√™ncia " +
        "est√£o sujeitos √† homologa√ß√£o ou declara√ß√£o de conformidade junto √† ANATEL. " +
        "Mesmo em remessas expressas/simplificadas, a exig√™ncia t√©cnica permanece. Confirme com o fornecedor se o produto j√° possui certifica√ß√£o v√°lida " +
        "e avalie a viabilidade de regulariza√ß√£o antes de importar."
      );

      if (!ncmSimplificada.value) {
        ncmSimplificada.value = "depende";
      }
    }

    const marker = "\n\n--- Observa√ß√µes autom√°ticas ---\n";
    updatingObs = true;

    if (autoMsgs.length > 0) {
      if (manualObs.trim().length > 0) {
        ncmObs.value = manualObs + marker + autoMsgs.join("\n\n");
      } else {
        ncmObs.value = "--- Observa√ß√µes autom√°ticas ---\n" + autoMsgs.join("\n\n");
      }
    } else {
      ncmObs.value = manualObs;
    }

    updatingObs = false;
  }

  ncmSimplificada.addEventListener("change", atualizarAlertasNCM);
  ncmAntidumping.addEventListener("change", atualizarAlertasNCM);
  ncmCide.addEventListener("change", atualizarObsAutomaticas);
  ncmComp.addEventListener("change", atualizarObsAutomaticas);
  orgaosCheckboxes.forEach(c => c.addEventListener("change", atualizarObsAutomaticas));
  bateriaRadios.forEach(r => r.addEventListener("change", atualizarObsAutomaticas));
  radioRadios.forEach(r => r.addEventListener("change", atualizarObsAutomaticas));

  document.getElementById("consultarNcmBtn")
    .addEventListener("click", function () {
      window.open("https://www4.receita.fazenda.gov.br/simulador/", "_blank");
    });

  /* ================================
       3) FUN√á√ÉO AUXILIAR
  =================================*/
  function brl(v) {
    return v.toLocaleString("pt-BR", { style: "currency", currency: "BRL" });
  }

  /* ================================
       4) C√ÅLCULO IMPORTA√á√ÉO
  =================================*/
  const calcularBtn = document.getElementById("calcularBtn");
  const resultadoCard = document.getElementById("resultadoCard");
  const resultadoModo = document.getElementById("resultadoModo");
  const resProdutos = document.getElementById("resProdutos");
  const resFreteSeguro = document.getElementById("resFreteSeguro");
  const resImpostos = document.getElementById("resImpostos");
  const resDespesas = document.getElementById("resDespesas");
  const resultadoTotal = document.getElementById("resultadoTotal");
  const resultadoUnitario = document.getElementById("resultadoUnitario");
  const resResumoBase = document.getElementById("resResumoBase");
  const viabilidadeCard = document.getElementById("viabilidadeCard");
  const vCustoProduto = document.getElementById("vCustoProduto");

  calcularBtn.addEventListener("click", () => {
    const modo = modoAtual();
    const cotacao = parseFloat(cotacaoInput.value);

    if (!cotacao || cotacao <= 0) {
      alert("Informe uma cota√ß√£o v√°lida do d√≥lar.");
      return;
    }

    let valorProdutosBRL = 0;
    let valorFreteSeguroBRL = 0;
    let valorImpostosBRL = 0;
    let despesasBRL = 0;
    let totalBRL = 0;
    let unitarioBRL = 0;
    let qtd = 0;
    let resumoTexto = "";

    if (modo === "simplificada") {
      // ======= SIMPLIFICADA =======
      const custoUSD = parseFloat(document.getElementById("custoUSD").value);
      qtd = parseInt(document.getElementById("quantidade").value);
      const freteUSD = parseFloat(document.getElementById("freteUSD").value);
      const seguroUSD = parseFloat(document.getElementById("seguroUSD").value);
      const iiPercent = parseFloat(document.getElementById("iiPercent").value) / 100;
      const icmsPercent = parseFloat(document.getElementById("icmsPercent").value) / 100;

      if (!qtd || qtd <= 0) {
        alert("Informe uma quantidade maior que zero.");
        return;
      }

      const valorProdutosUSD = custoUSD * qtd;
      const valorFreteSeguroUSD = freteUSD + seguroUSD;

      valorProdutosBRL = valorProdutosUSD * cotacao;
      valorFreteSeguroBRL = valorFreteSeguroUSD * cotacao;

      const valorAduaneiroBRL = valorProdutosBRL + valorFreteSeguroBRL;

      const valorII = valorAduaneiroBRL * iiPercent;
      const valorICMS = valorAduaneiroBRL * icmsPercent;
      valorImpostosBRL = valorII + valorICMS;

      const baseCourierBRL = valorProdutosBRL + valorFreteSeguroBRL + valorImpostosBRL;
      const courier2pctBRL = baseCourierBRL * 0.02;
      const courierMinBRL = 18.8 * cotacao;
      despesasBRL = courier2pctBRL < courierMinBRL ? courierMinBRL : courier2pctBRL;

      totalBRL = baseCourierBRL + despesasBRL;
      unitarioBRL = totalBRL / qtd;

      resumoTexto =
        "SIMPLIFICADA ‚Üí Base courier = Produtos + Frete/Seguro + Impostos = " +
        brl(baseCourierBRL) +
        ". Courier calculado como maior valor entre 2% da base (" +
        brl(courier2pctBRL) +
        ") e 18,8 √ó cota√ß√£o (" +
        brl(courierMinBRL) +
        ").";

    } else {
      // ======= FORMAL =======
      const custoUSD = parseFloat(document.getElementById("custoUSDFormal").value);
      qtd = parseInt(document.getElementById("quantidadeFormal").value);
      const freteUSD = parseFloat(document.getElementById("freteUSDFormal").value);
      const seguroUSD = parseFloat(document.getElementById("seguroUSDFormal").value);

      if (!qtd || qtd <= 0) {
        alert("Informe uma quantidade maior que zero na calculadora formal.");
        return;
      }

      const iiAliq = (parseFloat(document.getElementById("iiFormalPercent").value) || 0) / 100;
      const ipiAliq = (parseFloat(document.getElementById("ipiFormalPercent").value) || 0) / 100;
      const pisAliq = (parseFloat(document.getElementById("pisFormalPercent").value) || 0) / 100;
      const cofinsAliq = (parseFloat(document.getElementById("cofinsFormalPercent").value) || 0) / 100;
      const icmsAliq = (parseFloat(document.getElementById("icmsFormalPercent").value) || 0) / 100;
      const icmsGrossUp = document.getElementById("icmsFormalGrossUp").value === "sim";

      // Valor aduaneiro
      const valorProdutosUSD = custoUSD * qtd;
      const valorFreteSeguroUSD = freteUSD + seguroUSD;

      valorProdutosBRL = valorProdutosUSD * cotacao;
      valorFreteSeguroBRL = valorFreteSeguroUSD * cotacao;

      const cifBR = valorProdutosBRL + valorFreteSeguroBRL;

      const valorII = cifBR * iiAliq;
      const valorIPI = (cifBR + valorII) * ipiAliq;
      const valorPIS = (cifBR + valorII + valorIPI) * pisAliq;
      const valorCOFINS = (cifBR + valorII + valorIPI) * cofinsAliq;

      // Despesas aduaneiras
      const siscomexBRL = parseFloat(document.getElementById("siscomexBRL").value) || 0;
      const despachanteBRL = parseFloat(document.getElementById("despachanteBRL").value) || 0;
      const armazenagemBRL = parseFloat(document.getElementById("armazenagemBRL").value) || 0;
      const transporteBRL = parseFloat(document.getElementById("transporteBRL").value) || 0;
      const marinhaPercent = (parseFloat(document.getElementById("marinhaPercent").value) || 0) / 100;
      const outrasDespesasBRL = parseFloat(document.getElementById("outrasDespesasBRL").value) || 0;

      const freteBRL = freteUSD * cotacao;
      const marinhaBRL = freteBRL * marinhaPercent;

      despesasBRL =
        siscomexBRL +
        despachanteBRL +
        armazenagemBRL +
        transporteBRL +
        marinhaBRL +
        outrasDespesasBRL;

      // ICMS
      const baseICMS = cifBR + valorII + valorIPI + valorPIS + valorCOFINS + despesasBRL;
      let valorICMS = 0;
      if (icmsGrossUp) {
        // ICMS com gross-up
        const bruto = (baseICMS / (1 - icmsAliq)) * icmsAliq;
        valorICMS = bruto - baseICMS;
      } else {
        valorICMS = baseICMS * icmsAliq;
      }

      valorImpostosBRL =
        (valorII || 0) +
        (valorIPI || 0) +
        (valorPIS || 0) +
        (valorCOFINS || 0) +
        (valorICMS || 0);

      totalBRL = cifBR + valorImpostosBRL + despesasBRL;
      unitarioBRL = totalBRL / qtd;

      resumoTexto =
        "FORMAL ‚Üí CIF (produto + frete + seguro) = " + brl(cifBR) +
        ". Tributos calculados em cascata (II, IPI, PIS, COFINS) e ICMS " +
        (icmsGrossUp ? "com gross-up" : "sem gross-up") +
        " sobre a base CIF + tributos + despesas. Marinha Mercante aplicada como " +
        (marinhaPercent * 100).toFixed(2) +
        "% sobre o frete em BRL.";
    }

    // Preenche resultados comuns
    resultadoModo.textContent =
      modo === "simplificada"
        ? "Importa√ß√£o Simplificada (remessa expressa / courier)"
        : "Importa√ß√£o Formal Mar√≠tima ou A√©rea";

    resProdutos.textContent = brl(valorProdutosBRL);
    resFreteSeguro.textContent = brl(valorFreteSeguroBRL);
    resImpostos.textContent = brl(valorImpostosBRL);
    resDespesas.textContent = brl(despesasBRL);
    resultadoTotal.textContent = brl(totalBRL);
    resultadoUnitario.textContent = brl(unitarioBRL);
    resResumoBase.textContent = resumoTexto;

    resultadoCard.style.display = "block";

    // Alimenta custo unit√°rio da viabilidade
    vCustoProduto.value = unitarioBRL.toFixed(2);
    viabilidadeCard.style.display = "block";
  });

  /* ================================
       5) C√ÅLCULO VIABILIDADE DE VENDA
  =================================*/
  const btnCalcVenda = document.getElementById("btnCalcVenda");
  const viabResultado = document.getElementById("viabResultado");
  const viabMargem = document.getElementById("viabMargem");
  const viabROI = document.getElementById("viabROI");
  const viabMontao = document.getElementById("viabMontao");
  const viabAlerta = document.getElementById("viabAlerta");

  btnCalcVenda.addEventListener("click", () => {
    const venda = parseFloat(document.getElementById("vVenda").value);
    const tarifaFixa = parseFloat(document.getElementById("vTarifaFixa").value);
    const tarifaAnuncioPercent = parseFloat(document.getElementById("vTarifaAnuncioPercent").value) / 100;
    const impostosPercent = parseFloat(document.getElementById("vImpostosPercent").value) / 100;
    const embalagem = parseFloat(document.getElementById("vEmbalagem").value);
    const custoProduto = parseFloat(document.getElementById("vCustoProduto").value);
    const qtd = parseInt(document.getElementById("quantidade").value) || parseInt(document.getElementById("quantidadeFormal").value) || 0;

    if (!venda || !custoProduto) {
      alert("Informe pelo menos o valor da venda e o custo do produto.");
      return;
    }

    const tarifaAnuncioValor = venda * tarifaAnuncioPercent;
    const impostosValor = venda * impostosPercent;

    const margemContrib = venda
      - tarifaFixa
      - tarifaAnuncioValor
      - impostosValor
      - embalagem
      - custoProduto;

    const roiDecimal = custoProduto > 0 ? margemContrib / custoProduto : 0;
    const roiPercent = roiDecimal * 100;
    const montao = margemContrib * qtd;

    viabMargem.textContent = brl(margemContrib);
    viabROI.textContent = roiPercent.toFixed(0) + "%";
    viabMontao.textContent = brl(montao);

    if (margemContrib <= 0) {
      viabAlerta.className = "danger";
      viabAlerta.textContent = "‚ö†Ô∏è Margem negativa ou zero: este cen√°rio n√£o compensa trazer o produto nessas condi√ß√µes.";
    } else if (roiPercent < 30) {
      viabAlerta.className = "danger";
      viabAlerta.textContent = "‚ö†Ô∏è Margem baixa: avalie se o risco/capital investido compensa.";
    } else {
      viabAlerta.className = "success";
      viabAlerta.textContent = "‚úÖ Cen√°rio com boa margem. Ainda assim, considere volume de vendas, concorr√™ncia e riscos comerciais.";
    }

    viabResultado.style.display = "block";
    viabResultado.scrollIntoView({ behavior: "smooth", block: "center" });
  });

  /* ================================
       6) SERVICE WORKER (PWA)
  =================================*/
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("sw.js").catch(() => {
        // se der erro, s√≥ n√£o registra; a calculadora continua normal
      });
    });
  }
</script>

</body>
</html>
